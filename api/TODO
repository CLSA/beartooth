Replace all asserts with exceptions.
Add error codes to exceptions, add the codes to error popups on client side.
