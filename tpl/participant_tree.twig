{##
 # queue_list.twig
 # 
 # Lists queues.
 # @author Patrick Emond <emondpd@mcmaster.ca>
 # @see base_list.twig for parameters
 #}
{% extends "base_list.twig" %}

{% block javascript %}
  
  <script type="text/javascript">
    $( function() {
      {% if sites is defined %}
        // reload page if site selector is changed
        $( "#{{ widget.full }}__restrict_site" ).change( function() {
          var site_id = $( "#{{ widget.full }}__restrict_site option:selected" ).val();
          slot_load( {{ slot }},
                     "{{ widget.full }}",
                     "{{ widget.full }}",
                     { "restrict_site_id": site_id } );
        } );
      {% endif %}
      
      // tree widget
      $( "#{{ widget.full }}_tree" ).jstree( {
        plugins: [ "html_data", "ui", "themeroller" ],
        core: {
          animation: 200,
          html_titles: true,
          initially_open: [
            "{{ widget.full }}_0_1"
          ]
        },
        themeroller: {
          opened: "ui-icon-circle-triangle-s",
          closed: "ui-icon-circle-triangle-e",
          item_icon: "ui-icon-radio-on"
        }
      } );

      // queue buttons
      $( "button.{{ widget.full }}_button" ).button( {
        text: true,
        icons: { secondary: "ui-icon-document" }
      } ).click( function() {
        alert( $(this).attr( "id" ) );
      } );
      
    } );
  </script>

{% endblock javascript %}

{% block widget %}

  {% if sites is defined %}
    {% set restrict_site_id = restrict_site_id|default(0) %}
    <div style="padding-top: 4px; padding-bottom: 4px;">
      Restrict to site:
      <select id="{{ widget.full }}__restrict_site" class="ui-state-default">
        <option {% if 0 == restrict_site_id %}selected{% endif %}
                value="0">All Sites</option>
        {% for id, name in sites %}
          <option {% if id == restrict_site_id %}selected{% endif %}
                  value="{{ id }}">{{ name }}</option>
        {% endfor %}
      </select>
    </div>
  {% endif %}
  
  <div id="{{ widget.full }}_tree">
    <ul>
      {% for node in tree %}
        {% include "tree_widget.twig" with node %}
      {% endfor %}
    </ul>
  </div>

{% endblock widget %}
