"use strict";var cenozo=angular.module("cenozo");cenozo.controller("HeaderCtrl",["$scope","$state","CnBaseHeader","CnSession","CnHttpFactory","CnModalMessageFactory",async function($scope,$state,CnBaseHeader,CnSession,CnHttpFactory,CnModalMessageFactory){await CnBaseHeader.construct($scope);CnSession.promise.then(function(){CnSession.alertHeader=null==CnSession.user.assignment?undefined:"You are currently in a "+CnSession.user.assignment.type+" assignment";CnSession.onAlertHeader=function(){CnSession.updateData();CnSession.promise.then(function(){var controlName=CnSession.user.assignment.type+"_control";if(angular.isDefined(cenozoApp.module("assignment").actions[controlName])){$state.go("assignment."+controlName)}else{CnModalMessageFactory.instance({title:"Switch Roles For "+CnSession.user.assignment.type.ucWords()+" Assignment",message:"You cannot access your assignment under your current site and role. "+"The site and role selection dialog will now be opened, please use it to switch to the site and "+"role under which you started the assignment.\n\n"+"Once you have switched you will be able to access your assignment.",error:true}).show().then(function(){CnSession.showSiteRoleModal()})}})}});var logoutOperation=$scope.operationList.findByProperty("title","Logout");var logoutFunction=logoutOperation.execute;logoutOperation.execute=function(){function showAssignmentExists(assignmentType){var controlName=assignmentType+"_control";var hasAccess=angular.isDefined(cenozoApp.module("assignment").actions[controlName]);CnModalMessageFactory.instance({title:"Active "+(assignmentType?assignmentType.ucWords()+" ":"")+"Assignment Detected",message:"You cannot log out while in an open assignment!\n\n"+(hasAccess?"In order to log out you will need to close your open assignment. "+"You will now be redirected to your assignment.":"In order to log out you will need to close your open assignment, however, you cannot access "+"your assignment from your current site and role. "+"The site and role selection dialog will now be opened, please use it to switch to the site and "+"role under which you started the assignment.\n\n"+"Once you have switched you will be able to access your assignment."),error:true}).show().then(function(){if(hasAccess)$state.go("assignment."+controlName);else CnSession.showSiteRoleModal()})}CnHttpFactory.instance({path:"assignment/0",data:{select:{column:[{table:"qnaire",column:"type"}]}},onError:function(response){if(307==response.status){logoutFunction()}else if(403==response.status){showAssignmentExists()}else{CnModalMessageFactory.httpError(response)}}}).get().then(function(response){showAssignmentExists(response.data.type)})}}]);
